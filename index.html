<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kenyang - Sekolah</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'green-primary': '#16a34a',
                        'green-secondary': '#22c55e',
                        'green-light': '#dcfce7',
                        'green-dark': '#15803d'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-green-50 min-h-screen">
    <!-- Login Selection Screen -->
    <div id="loginSelection" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <div class="bg-green-primary rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4">
                    <span class="text-white text-3xl">🍽️</span>
                </div>
                <h1 class="text-3xl font-bold text-green-primary mb-2">Kenyang</h1>
                <p class="text-gray-600">Pilih jenis akun Anda</p>
            </div>
            
            <div class="space-y-4">
                <button onclick="showLogin('student')" class="w-full bg-green-primary hover:bg-green-dark text-white font-semibold py-4 px-6 rounded-xl transition duration-300 flex items-center justify-center space-x-3">
                    <span class="text-2xl">👨‍🎓</span>
                    <span class="text-lg">Login Siswa</span>
                </button>
                
                <button onclick="showLogin('seller')" class="w-full bg-green-secondary hover:bg-green-primary text-white font-semibold py-4 px-6 rounded-xl transition duration-300 flex items-center justify-center space-x-3">
                    <span class="text-2xl">👨‍🍳</span>
                    <span class="text-lg">Login Penjual</span>
                </button>
                
                <button onclick="showRegister()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-4 px-6 rounded-xl transition duration-300 flex items-center justify-center space-x-3">
                    <span class="text-2xl">📝</span>
                    <span class="text-lg">Daftar Akun Baru</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Register Form -->
    <div id="registerForm" class="hidden min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md">
            <button onclick="backToSelection()" class="mb-4 text-green-primary hover:text-green-dark">
                ← Kembali
            </button>
            
            <div class="text-center mb-8">
                <div class="bg-green-primary rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
                    <span class="text-white text-2xl">📝</span>
                </div>
                <h2 class="text-2xl font-bold text-green-primary mb-2">Daftar Akun Baru</h2>
            </div>
            
            <form onsubmit="handleRegister(event)" class="space-y-4">
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Tipe Akun</label>
                    <select id="registerType" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-primary focus:border-transparent">
                        <option value="">Pilih tipe akun</option>
                        <option value="student">Siswa</option>
                        <option value="seller">Penjual</option>
                    </select>
                </div>
                
                <div id="standSelection" class="hidden">
                    <label class="block text-gray-700 font-medium mb-2">Stand Kantin</label>
                    <select id="registerStand" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-primary focus:border-transparent">
                        <option value="">Pilih stand kantin</option>
                        <option value="miracle">Miracle - Western & Fusion</option>
                        <option value="sepiring-hati">Sepiring Hati - Masakan Rumahan</option>
                        <option value="om-china">Om China - Chinese Food</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Nama Lengkap</label>
                    <input type="text" id="registerName" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-primary focus:border-transparent">
                </div>
                
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Username</label>
                    <input type="text" id="registerUsername" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-primary focus:border-transparent">
                </div>
                
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Password</label>
                    <input type="password" id="registerPassword" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-primary focus:border-transparent">
                </div>
                
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Konfirmasi Password</label>
                    <input type="password" id="registerConfirmPassword" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-primary focus:border-transparent">
                </div>
                
                <button type="submit" class="w-full bg-green-primary hover:bg-green-dark text-white font-semibold py-3 px-6 rounded-lg transition duration-300">
                    Daftar
                </button>
            </form>
        </div>
    </div>

    <!-- Seller Stand Selection -->
    <div id="sellerStandSelection" class="hidden min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-2xl">
            <button onclick="backToSelection()" class="mb-4 text-green-primary hover:text-green-dark">
                ← Kembali
            </button>
            
            <div class="text-center mb-8">
                <div class="bg-green-primary rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
                    <span class="text-white text-2xl">👨‍🍳</span>
                </div>
                <h2 class="text-2xl font-bold text-green-primary mb-2">Pilih Stand Kantin</h2>
                <p class="text-gray-600">Pilih stand kantin yang ingin Anda kelola</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <button onclick="selectStand('miracle')" class="bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-semibold py-6 px-4 rounded-xl transition duration-300 flex flex-col items-center space-y-3">
                    <span class="text-3xl">✨</span>
                    <span class="text-lg">Miracle</span>
                    <span class="text-sm opacity-90">Western & Fusion</span>
                </button>
                
                <button onclick="selectStand('sepiring-hati')" class="bg-gradient-to-r from-red-500 to-orange-500 hover:from-red-600 hover:to-orange-600 text-white font-semibold py-6 px-4 rounded-xl transition duration-300 flex flex-col items-center space-y-3">
                    <span class="text-3xl">❤️</span>
                    <span class="text-lg">Sepiring Hati</span>
                    <span class="text-sm opacity-90">Masakan Rumahan</span>
                </button>
                
                <button onclick="selectStand('om-china')" class="bg-gradient-to-r from-yellow-500 to-red-600 hover:from-yellow-600 hover:to-red-700 text-white font-semibold py-6 px-4 rounded-xl transition duration-300 flex flex-col items-center space-y-3">
                    <span class="text-3xl">🥢</span>
                    <span class="text-lg">Om China</span>
                    <span class="text-sm opacity-90">Chinese Food</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Login Form -->
    <div id="loginForm" class="hidden min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md">
            <button onclick="backToStandSelection()" class="mb-4 text-green-primary hover:text-green-dark">
                ← Kembali
            </button>
            
            <div class="text-center mb-8">
                <div class="bg-green-primary rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
                    <span id="loginIcon" class="text-white text-2xl">👨‍🎓</span>
                </div>
                <h2 id="loginTitle" class="text-2xl font-bold text-green-primary mb-2">Login Siswa</h2>
            </div>
            
            <form onsubmit="handleLogin(event)" class="space-y-4">
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Username</label>
                    <input type="text" id="username" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-primary focus:border-transparent">
                </div>
                
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Password</label>
                    <input type="password" id="password" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-primary focus:border-transparent">
                </div>
                
                <button type="submit" class="w-full bg-green-primary hover:bg-green-dark text-white font-semibold py-3 px-6 rounded-lg transition duration-300">
                    Masuk
                </button>
            </form>
        </div>
    </div>

    <!-- Student Dashboard -->
    <div id="studentDashboard" class="hidden min-h-screen">
        <!-- Header -->
        <header class="bg-green-primary text-white p-4 shadow-lg">
            <div class="flex justify-between items-center max-w-6xl mx-auto">
                <div class="flex items-center space-x-3">
                    <span class="text-2xl">🍽️</span>
                    <div>
                        <h1 class="text-xl font-bold">Kenyang</h1>
                        <p id="welcomeStudent" class="text-sm opacity-90">Selamat datang!</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div id="orderDeadline" class="bg-green-dark px-3 py-1 rounded-lg text-sm"></div>
                    <button onclick="showPaymentHistory()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition duration-300">
                        📋 Riwayat
                    </button>
                    <button onclick="showCart()" class="relative bg-green-secondary hover:bg-green-primary px-4 py-2 rounded-lg transition duration-300">
                        🛒 Keranjang <span id="cartCount" class="bg-red-500 text-white rounded-full px-2 py-1 text-xs ml-1">0</span>
                    </button>
                    <button onclick="showAccountSettings()" class="bg-gray-500 hover:bg-gray-600 px-4 py-2 rounded-lg transition duration-300">⚙️ Akun</button>
                    <button onclick="logout()" class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-lg transition duration-300">Keluar</button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-6xl mx-auto p-6">
            <!-- Canteen Stands -->
            <div class="mb-8">
                <h2 class="text-2xl font-bold text-green-primary mb-6">Stand Kantin</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div onclick="showStandMenu('miracle')" class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition duration-300 cursor-pointer border-2 hover:border-green-primary">
                        <div class="text-center">
                            <div class="bg-gradient-to-r from-purple-500 to-pink-500 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
                                <span class="text-white text-2xl">✨</span>
                            </div>
                            <h3 class="text-xl font-bold text-purple-600 mb-2">Miracle</h3>
                            <p class="text-gray-600 text-sm">Makanan Western & Fusion</p>
                            <div class="mt-3 text-green-primary font-medium">Klik untuk lihat menu →</div>
                        </div>
                    </div>
                    
                    <div onclick="showStandMenu('sepiring-hati')" class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition duration-300 cursor-pointer border-2 hover:border-green-primary">
                        <div class="text-center">
                            <div class="bg-gradient-to-r from-red-500 to-orange-500 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
                                <span class="text-white text-2xl">❤️</span>
                            </div>
                            <h3 class="text-xl font-bold text-red-600 mb-2">Sepiring Hati</h3>
                            <p class="text-gray-600 text-sm">Masakan Rumahan Indonesia</p>
                            <div class="mt-3 text-green-primary font-medium">Klik untuk lihat menu →</div>
                        </div>
                    </div>
                    
                    <div onclick="showStandMenu('om-china')" class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition duration-300 cursor-pointer border-2 hover:border-green-primary">
                        <div class="text-center">
                            <div class="bg-gradient-to-r from-yellow-500 to-red-600 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
                                <span class="text-white text-2xl">🥢</span>
                            </div>
                            <h3 class="text-xl font-bold text-yellow-600 mb-2">Om China</h3>
                            <p class="text-gray-600 text-sm">Masakan Chinese Food</p>
                            <div class="mt-3 text-green-primary font-medium">Klik untuk lihat menu →</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Menu Section -->
            <div class="mb-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 id="menuTitle" class="text-2xl font-bold text-green-primary">Semua Menu</h2>
                    <button id="backToAllMenus" onclick="showAllMenus()" class="hidden bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition duration-300">
                        ← Kembali ke Semua Menu
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="menuItems">
                    <!-- Menu items will be populated here -->
                </div>
            </div>
        </main>
    </div>

    <!-- Seller Dashboard -->
    <div id="sellerDashboard" class="hidden min-h-screen">
        <!-- Header -->
        <header class="bg-green-primary text-white p-4 shadow-lg">
            <div class="flex justify-between items-center max-w-6xl mx-auto">
                <div class="flex items-center space-x-3">
                    <span id="sellerStandIcon" class="text-2xl">👨‍🍳</span>
                    <div>
                        <h1 class="text-xl font-bold">Dashboard Penjual</h1>
                        <p id="sellerStandName" class="text-sm opacity-90">Stand Kantin</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="showAddProduct()" class="bg-green-secondary hover:bg-green-primary px-4 py-2 rounded-lg transition duration-300">
                        ➕ Tambah Produk
                    </button>
                    <button onclick="showAccountSettings()" class="bg-gray-500 hover:bg-gray-600 px-4 py-2 rounded-lg transition duration-300">⚙️ Akun</button>
                    <button onclick="logout()" class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-lg transition duration-300">Keluar</button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-6xl mx-auto p-6">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Product Management -->
                <div class="lg:col-span-2">
                    <h2 class="text-2xl font-bold text-green-primary mb-4">Produk Saya</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="sellerProducts">
                        <!-- Products will be populated here -->
                    </div>
                </div>

                <!-- Orders -->
                <div>
                    <h2 class="text-2xl font-bold text-green-primary mb-4">Pesanan Hari Ini</h2>
                    <div class="space-y-4" id="todayOrders">
                        <!-- Orders will be populated here -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Account Settings Modal -->
    <div id="accountSettingsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-green-primary">Pengaturan Akun</h3>
                <button onclick="closeAccountSettings()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            
            <div id="accountInfo" class="space-y-4 mb-6">
                <!-- Account info will be populated here -->
            </div>
            
            <div class="space-y-3">
                <button onclick="showChangePassword()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg transition duration-300">
                    🔒 Ubah Password
                </button>
                
                <button onclick="confirmDeleteAccount()" class="w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-3 px-6 rounded-lg transition duration-300">
                    🗑️ Hapus Akun
                </button>
            </div>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div id="changePasswordModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl p-6 w-full max-w-md">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-green-primary">Ubah Password</h3>
                <button onclick="closeChangePassword()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            
            <form onsubmit="handleChangePassword(event)" class="space-y-4">
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Password Lama</label>
                    <input type="password" id="oldPassword" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-primary focus:border-transparent">
                </div>
                
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Password Baru</label>
                    <input type="password" id="newPassword" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-primary focus:border-transparent">
                </div>
                
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Konfirmasi Password Baru</label>
                    <input type="password" id="confirmNewPassword" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-primary focus:border-transparent">
                </div>
                
                <button type="submit" class="w-full bg-green-primary hover:bg-green-dark text-white font-semibold py-3 px-6 rounded-lg transition duration-300">
                    Ubah Password
                </button>
            </form>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div id="addProductModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-green-primary">Tambah Produk Baru</h3>
                <button onclick="closeAddProduct()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            
            <form onsubmit="addProduct(event)" class="space-y-4">
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Nama Produk</label>
                    <input type="text" id="productName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-primary focus:border-transparent">
                </div>
                
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Harga (Rp)</label>
                    <input type="number" id="productPrice" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-primary focus:border-transparent">
                </div>
                
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Deskripsi</label>
                    <textarea id="productDescription" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-primary focus:border-transparent"></textarea>
                </div>
                
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Gambar Produk</label>
                    <div class="space-y-3">
                        <!-- Image Upload -->
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-green-primary transition-colors">
                            <input type="file" id="productImageFile" accept="image/*" class="hidden" onchange="handleImageUpload(this, 'imagePreview')">
                            <button type="button" onclick="document.getElementById('productImageFile').click()" class="bg-green-primary hover:bg-green-dark text-white px-4 py-2 rounded-lg transition duration-300">
                                📷 Pilih Gambar dari Galeri
                            </button>
                            <p class="text-xs text-gray-500 mt-2">Atau drag & drop gambar di sini</p>
                        </div>
                        
                        <!-- Image Preview -->
                        <div id="imagePreview" class="hidden">
                            <img id="previewImg" src="" alt="Preview" class="w-full h-32 object-cover rounded-lg border">
                            <button type="button" onclick="removeImage('imagePreview')" class="mt-2 text-red-500 hover:text-red-700 text-sm">
                                🗑️ Hapus Gambar
                            </button>
                        </div>
                        
                        <!-- Alternative URL Input -->
                        <div class="text-center text-gray-500 text-sm">atau</div>
                        <input type="url" id="productImageUrl" placeholder="https://example.com/image.jpg" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-primary focus:border-transparent">
                        <p class="text-xs text-gray-500">Masukkan URL gambar dari internet (opsional)</p>
                    </div>
                </div>
                
                <div class="border-t pt-4">
                    <h4 class="font-medium text-gray-700 mb-3">Informasi Rekening</h4>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">Bank</label>
                            <input type="text" id="bankName" placeholder="BCA" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">No. Rekening</label>
                            <input type="text" id="accountNumber" placeholder="283642957" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-primary focus:border-transparent">
                        </div>
                    </div>
                    <div class="mt-3">
                        <label class="block text-gray-700 font-medium mb-2">Atas Nama</label>
                        <input type="text" id="accountName" placeholder="Nama Pemilik Rekening" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-primary focus:border-transparent">
                    </div>
                </div>
                
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Add-ons</label>
                    <div id="addonsContainer" class="space-y-2">
                        <div class="flex space-x-2">
                            <input type="text" placeholder="Nama add-on" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg">
                            <input type="number" placeholder="Harga" class="w-24 px-3 py-2 border border-gray-300 rounded-lg">
                            <button type="button" onclick="removeAddon(this)" class="bg-red-500 text-white px-3 py-2 rounded-lg hover:bg-red-600">-</button>
                        </div>
                    </div>
                    <button type="button" onclick="addAddonField()" class="mt-2 bg-green-secondary text-white px-4 py-2 rounded-lg hover:bg-green-primary">+ Tambah Add-on</button>
                </div>
                
                <button type="submit" class="w-full bg-green-primary hover:bg-green-dark text-white font-semibold py-3 px-6 rounded-lg transition duration-300">
                    Tambah Produk
                </button>
            </form>
        </div>
    </div>

    <!-- Cart Modal -->
    <div id="cartModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-green-primary">Keranjang Belanja</h3>
                <button onclick="closeCart()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            
            <div id="cartItems" class="space-y-4 mb-6">
                <!-- Cart items will be populated here -->
            </div>
            
            <div class="border-t pt-4">
                <div class="flex justify-between items-center mb-4">
                    <span class="text-lg font-bold">Total:</span>
                    <span id="cartTotal" class="text-lg font-bold text-green-primary">Rp 0</span>
                </div>
                
                <div class="space-y-3">
                    <h4 class="font-medium text-gray-700">Pilih Metode Pembayaran:</h4>
                    <div class="space-y-2">
                        <label class="flex items-center space-x-3 p-3 border border-gray-300 rounded-lg hover:bg-gray-50 cursor-pointer">
                            <input type="radio" name="payment" value="bca" class="text-green-primary">
                            <span class="text-blue-600 font-bold">BCA</span>
                            <span class="text-sm text-gray-600">E-Wallet</span>
                        </label>
                        <label class="flex items-center space-x-3 p-3 border border-gray-300 rounded-lg hover:bg-gray-50 cursor-pointer">
                            <input type="radio" name="payment" value="gopay" class="text-green-primary">
                            <span class="text-green-600 font-bold">GoPay</span>
                            <span class="text-sm text-gray-600">E-Wallet</span>
                        </label>
                    </div>
                </div>
                
                <button onclick="checkout()" class="w-full bg-green-primary hover:bg-green-dark text-white font-semibold py-3 px-6 rounded-lg transition duration-300 mt-4">
                    Pesan Sekarang
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Product Modal -->
    <div id="editProductModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-green-primary">Edit Produk</h3>
                <button onclick="closeEditProduct()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            
            <form onsubmit="updateProduct(event)" class="space-y-4">
                <input type="hidden" id="editProductId">
                
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Nama Produk</label>
                    <input type="text" id="editProductName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-primary focus:border-transparent">
                </div>
                
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Harga (Rp)</label>
                    <input type="number" id="editProductPrice" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-primary focus:border-transparent">
                </div>
                
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Deskripsi</label>
                    <textarea id="editProductDescription" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-primary focus:border-transparent"></textarea>
                </div>
                
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Gambar Produk</label>
                    <div class="space-y-3">
                        <!-- Current Image Display -->
                        <div id="currentImageDisplay" class="hidden">
                            <img id="currentImg" src="" alt="Current Image" class="w-full h-32 object-cover rounded-lg border">
                            <p class="text-xs text-gray-500 mt-1">Gambar saat ini</p>
                        </div>
                        
                        <!-- Image Upload -->
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-green-primary transition-colors">
                            <input type="file" id="editProductImageFile" accept="image/*" class="hidden" onchange="handleImageUpload(this, 'editImagePreview')">
                            <button type="button" onclick="document.getElementById('editProductImageFile').click()" class="bg-green-primary hover:bg-green-dark text-white px-4 py-2 rounded-lg transition duration-300">
                                📷 Ganti Gambar
                            </button>
                            <p class="text-xs text-gray-500 mt-2">Pilih gambar baru dari galeri</p>
                        </div>
                        
                        <!-- New Image Preview -->
                        <div id="editImagePreview" class="hidden">
                            <img id="editPreviewImg" src="" alt="Preview" class="w-full h-32 object-cover rounded-lg border">
                            <button type="button" onclick="removeImage('editImagePreview')" class="mt-2 text-red-500 hover:text-red-700 text-sm">
                                🗑️ Hapus Gambar Baru
                            </button>
                        </div>
                        
                        <!-- Alternative URL Input -->
                        <div class="text-center text-gray-500 text-sm">atau</div>
                        <input type="url" id="editProductImageUrl" placeholder="https://example.com/image.jpg" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-primary focus:border-transparent">
                        <p class="text-xs text-gray-500">Masukkan URL gambar dari internet</p>
                    </div>
                </div>
                
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Add-ons</label>
                    <div id="editAddonsContainer" class="space-y-2">
                        <!-- Add-ons will be populated here -->
                    </div>
                    <button type="button" onclick="addEditAddonField()" class="mt-2 bg-green-secondary text-white px-4 py-2 rounded-lg hover:bg-green-primary">+ Tambah Add-on</button>
                </div>
                
                <button type="submit" class="w-full bg-green-primary hover:bg-green-dark text-white font-semibold py-3 px-6 rounded-lg transition duration-300">
                    Update Produk
                </button>
            </form>
        </div>
    </div>

    <!-- Order Item Modal -->
    <div id="orderModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl p-6 w-full max-w-md">
            <div class="flex justify-between items-center mb-4">
                <h3 id="orderModalTitle" class="text-xl font-bold text-green-primary">Pesan Item</h3>
                <button onclick="closeOrderModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            
            <div id="orderModalContent">
                <!-- Order content will be populated here -->
            </div>
        </div>
    </div>

    <!-- Payment History Modal -->
    <div id="paymentHistoryModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-green-primary">Riwayat Pembayaran</h3>
                <button onclick="closePaymentHistory()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            
            <!-- Filter Tabs -->
            <div class="flex space-x-2 mb-6">
                <button onclick="filterHistory('all')" id="filterAll" class="px-4 py-2 rounded-lg bg-green-primary text-white font-medium">
                    Semua
                </button>
                <button onclick="filterHistory('paid')" id="filterPaid" class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700 font-medium hover:bg-gray-300">
                    Sudah Bayar
                </button>
                <button onclick="filterHistory('unpaid')" id="filterUnpaid" class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700 font-medium hover:bg-gray-300">
                    Belum Bayar
                </button>
            </div>
            
            <!-- History Content -->
            <div id="historyContent" class="space-y-4">
                <!-- History items will be populated here -->
            </div>
        </div>
    </div>

    <!-- Payment Info Modal -->
    <div id="paymentInfoModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto">
            <div class="text-center mb-6">
                <div class="bg-green-primary rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
                    <span class="text-white text-2xl">✅</span>
                </div>
                <h3 class="text-2xl font-bold text-green-primary mb-2">Pesanan Berhasil!</h3>
                <p class="text-gray-600">Silakan transfer ke rekening berikut</p>
            </div>
            
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
                <div class="flex items-center mb-2">
                    <span class="text-yellow-600 text-lg mr-2">⚠️</span>
                    <span class="font-medium text-yellow-800">Penting!</span>
                </div>
                <p class="text-yellow-700 text-sm">Batas pemesanan: <strong>07:20 Pagi</strong></p>
            </div>
            
            <div id="paymentInfoContent" class="space-y-4 mb-6">
                <!-- Payment info will be populated here -->
            </div>
            
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                <h4 class="font-medium text-blue-800 mb-2">Cara Pembayaran:</h4>
                <ol class="text-sm text-blue-700 space-y-1">
                    <li>1. Transfer sesuai total yang tertera</li>
                    <li>2. Simpan bukti transfer</li>
                    <li>3. Tunjukkan bukti ke penjual saat mengambil pesanan</li>
                </ol>
            </div>
            
            <button onclick="closePaymentInfo()" class="w-full bg-green-primary hover:bg-green-dark text-white font-semibold py-3 px-6 rounded-lg transition duration-300">
                Mengerti
            </button>
        </div>
    </div>

    <script>
        // Database Management System using localStorage
        class Database {
            static init() {
                // Initialize default data if not exists
                if (!localStorage.getItem('kenyang_users')) {
                    localStorage.setItem('kenyang_users', JSON.stringify([]));
                }
                if (!localStorage.getItem('kenyang_products')) {
                    localStorage.setItem('kenyang_products', JSON.stringify(this.getDefaultProducts()));
                }
                if (!localStorage.getItem('kenyang_orders')) {
                    localStorage.setItem('kenyang_orders', JSON.stringify([]));
                }
                if (!localStorage.getItem('kenyang_bank_accounts')) {
                    localStorage.setItem('kenyang_bank_accounts', JSON.stringify(this.getDefaultBankAccounts()));
                }
            }

            static getDefaultProducts() {
                return [
                    // Miracle Stand - Western & Fusion
                    {
                        id: 1,
                        name: "Chicken Burger",
                        price: 25000,
                        description: "Burger ayam crispy dengan keju dan sayuran segar",
                        seller: "Miracle",
                        stand: "miracle",
                        image: "https://via.placeholder.com/300x200/4ade80/ffffff?text=Chicken+Burger",
                        addons: [
                            { name: "Extra Cheese", price: 5000 },
                            { name: "Extra Patty", price: 12000 },
                            { name: "French Fries", price: 8000 }
                        ]
                    },
                    {
                        id: 2,
                        name: "Pasta Carbonara",
                        price: 28000,
                        description: "Pasta creamy dengan bacon dan keju parmesan",
                        seller: "Miracle",
                        stand: "miracle",
                        image: "https://via.placeholder.com/300x200/4ade80/ffffff?text=Pasta+Carbonara",
                        addons: [
                            { name: "Extra Bacon", price: 8000 },
                            { name: "Extra Cheese", price: 5000 },
                            { name: "Garlic Bread", price: 6000 }
                        ]
                    },
                    {
                        id: 3,
                        name: "Fish & Chips",
                        price: 30000,
                        description: "Ikan dori crispy dengan kentang goreng dan tartar sauce",
                        seller: "Miracle",
                        stand: "miracle",
                        image: "https://via.placeholder.com/300x200/4ade80/ffffff?text=Fish+%26+Chips",
                        addons: [
                            { name: "Extra Fish", price: 15000 },
                            { name: "Coleslaw", price: 7000 },
                            { name: "Extra Sauce", price: 3000 }
                        ]
                    },
                    
                    // Sepiring Hati Stand - Indonesian Home Cooking
                    {
                        id: 4,
                        name: "Nasi Gudeg",
                        price: 15000,
                        description: "Nasi gudeg khas Yogyakarta dengan ayam dan telur",
                        seller: "Sepiring Hati",
                        stand: "sepiring-hati",
                        image: "https://via.placeholder.com/300x200/ef4444/ffffff?text=Nasi+Gudeg",
                        addons: [
                            { name: "Tambah Nasi", price: 3000 },
                            { name: "Tambah Ayam", price: 8000 },
                            { name: "Tambah Telur", price: 5000 }
                        ]
                    },
                    {
                        id: 5,
                        name: "Soto Ayam",
                        price: 13000,
                        description: "Soto ayam dengan nasi dan kerupuk",
                        seller: "Sepiring Hati",
                        stand: "sepiring-hati",
                        image: "https://via.placeholder.com/300x200/ef4444/ffffff?text=Soto+Ayam",
                        addons: [
                            { name: "Tambah Nasi", price: 3000 },
                            { name: "Tambah Kuah", price: 2000 },
                            { name: "Tambah Ayam", price: 7000 }
                        ]
                    },
                    {
                        id: 6,
                        name: "Rendang Daging",
                        price: 20000,
                        description: "Rendang daging sapi dengan nasi putih dan sambal",
                        seller: "Sepiring Hati",
                        stand: "sepiring-hati",
                        image: "https://via.placeholder.com/300x200/ef4444/ffffff?text=Rendang+Daging",
                        addons: [
                            { name: "Tambah Nasi", price: 3000 },
                            { name: "Tambah Daging", price: 10000 },
                            { name: "Kerupuk", price: 2000 }
                        ]
                    },
                    
                    // Om China Stand - Chinese Food
                    {
                        id: 7,
                        name: "Mie Ayam",
                        price: 12000,
                        description: "Mie ayam dengan pangsit dan bakso",
                        seller: "Om China",
                        stand: "om-china",
                        image: "https://via.placeholder.com/300x200/eab308/ffffff?text=Mie+Ayam",
                        addons: [
                            { name: "Tambah Mie", price: 2000 },
                            { name: "Tambah Ayam", price: 6000 },
                            { name: "Tambah Pangsit", price: 4000 }
                        ]
                    },
                    {
                        id: 8,
                        name: "Nasi Goreng Spesial",
                        price: 18000,
                        description: "Nasi goreng dengan telur, ayam, dan udang",
                        seller: "Om China",
                        stand: "om-china",
                        image: "https://via.placeholder.com/300x200/eab308/ffffff?text=Nasi+Goreng",
                        addons: [
                            { name: "Tambah Telur", price: 5000 },
                            { name: "Tambah Ayam", price: 8000 },
                            { name: "Kerupuk Udang", price: 3000 }
                        ]
                    },
                    {
                        id: 9,
                        name: "Cap Cay",
                        price: 16000,
                        description: "Tumisan sayuran campur dengan saus tiram",
                        seller: "Om China",
                        stand: "om-china",
                        image: "https://via.placeholder.com/300x200/eab308/ffffff?text=Cap+Cay",
                        addons: [
                            { name: "Tambah Nasi", price: 3000 },
                            { name: "Tambah Tahu", price: 4000 },
                            { name: "Tambah Bakso", price: 5000 }
                        ]
                    }
                ];
            }

            static getDefaultBankAccounts() {
                return {
                    'Miracle': {
                        bank: 'BCA',
                        accountNumber: '283642957',
                        accountName: 'Miracle Food'
                    },
                    'Sepiring Hati': {
                        bank: 'BCA',
                        accountNumber: '194758362',
                        accountName: 'Sepiring Hati'
                    },
                    'Om China': {
                        bank: 'BCA',
                        accountNumber: '572839461',
                        accountName: 'Om China Restaurant'
                    }
                };
            }

            // User management
            static getUsers() {
                return JSON.parse(localStorage.getItem('kenyang_users') || '[]');
            }

            static saveUsers(users) {
                localStorage.setItem('kenyang_users', JSON.stringify(users));
            }

            static addUser(user) {
                const users = this.getUsers();
                users.push(user);
                this.saveUsers(users);
            }

            static getUserByUsername(username) {
                const users = this.getUsers();
                return users.find(user => user.username === username);
            }

            static updateUser(username, updatedData) {
                const users = this.getUsers();
                const index = users.findIndex(user => user.username === username);
                if (index !== -1) {
                    users[index] = { ...users[index], ...updatedData };
                    this.saveUsers(users);
                    return true;
                }
                return false;
            }

            static deleteUser(username) {
                const users = this.getUsers();
                const filteredUsers = users.filter(user => user.username !== username);
                this.saveUsers(filteredUsers);
                
                // Also delete user's orders
                const orders = this.getOrders();
                const filteredOrders = orders.filter(order => order.student !== username);
                this.saveOrders(filteredOrders);
            }

            // Product management
            static getProducts() {
                return JSON.parse(localStorage.getItem('kenyang_products') || '[]');
            }

            static saveProducts(products) {
                localStorage.setItem('kenyang_products', JSON.stringify(products));
            }

            static addProduct(product) {
                const products = this.getProducts();
                product.id = Date.now();
                products.push(product);
                this.saveProducts(products);
                return product;
            }

            static updateProduct(productId, updatedData) {
                const products = this.getProducts();
                const index = products.findIndex(product => product.id === productId);
                if (index !== -1) {
                    products[index] = { ...products[index], ...updatedData };
                    this.saveProducts(products);
                    return true;
                }
                return false;
            }

            static deleteProduct(productId) {
                const products = this.getProducts();
                const filteredProducts = products.filter(product => product.id !== productId);
                this.saveProducts(filteredProducts);
            }

            // Order management
            static getOrders() {
                return JSON.parse(localStorage.getItem('kenyang_orders') || '[]');
            }

            static saveOrders(orders) {
                localStorage.setItem('kenyang_orders', JSON.stringify(orders));
            }

            static addOrder(order) {
                const orders = this.getOrders();
                order.id = Date.now();
                orders.push(order);
                this.saveOrders(orders);
                return order;
            }

            static updateOrder(orderId, updatedData) {
                const orders = this.getOrders();
                const index = orders.findIndex(order => order.id === orderId);
                if (index !== -1) {
                    orders[index] = { ...orders[index], ...updatedData };
                    this.saveOrders(orders);
                    return true;
                }
                return false;
            }

            // Bank account management
            static getBankAccounts() {
                return JSON.parse(localStorage.getItem('kenyang_bank_accounts') || '{}');
            }

            static saveBankAccounts(accounts) {
                localStorage.setItem('kenyang_bank_accounts', JSON.stringify(accounts));
            }

            static updateBankAccount(seller, accountData) {
                const accounts = this.getBankAccounts();
                accounts[seller] = accountData;
                this.saveBankAccounts(accounts);
            }
        }

        // Global variables
        let currentUser = null;
        let userType = null;
        let currentSellerStand = null;
        let cart = [];

        // Initialize database
        Database.init();

        // Show order deadline warning
        function showOrderDeadlineWarning() {
            const deadlineElement = document.getElementById('orderDeadline');
            if (deadlineElement) {
                deadlineElement.innerHTML = '⚠️ Batas Pemesanan: 07:20 Pagi';
                deadlineElement.className = 'bg-yellow-500 px-3 py-1 rounded-lg text-sm text-white';
            }
        }

        // Registration functions
        function showRegister() {
            document.getElementById('loginSelection').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
            
            // Show/hide stand selection based on account type
            document.getElementById('registerType').addEventListener('change', function() {
                const standSelection = document.getElementById('standSelection');
                const registerStand = document.getElementById('registerStand');
                
                if (this.value === 'seller') {
                    standSelection.classList.remove('hidden');
                    registerStand.required = true;
                } else {
                    standSelection.classList.add('hidden');
                    registerStand.required = false;
                }
            });
        }

        function handleRegister(event) {
            event.preventDefault();
            
            const type = document.getElementById('registerType').value;
            const name = document.getElementById('registerName').value;
            const username = document.getElementById('registerUsername').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            const stand = document.getElementById('registerStand').value;
            
            // Validation
            if (password !== confirmPassword) {
                alert('Password dan konfirmasi password tidak cocok!');
                return;
            }
            
            if (type === 'seller' && !stand) {
                alert('Pilih stand kantin untuk akun penjual!');
                return;
            }
            
            // Check if username already exists
            if (Database.getUserByUsername(username)) {
                alert('Username sudah digunakan! Pilih username lain.');
                return;
            }
            
            // Create new user
            const newUser = {
                username: username,
                password: password,
                name: name,
                type: type,
                stand: stand || null,
                createdAt: new Date().toISOString()
            };
            
            Database.addUser(newUser);
            alert('Akun berhasil dibuat! Silakan login.');
            
            // Reset form and go back to login selection
            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('loginSelection').classList.remove('hidden');
            
            // Clear form
            document.getElementById('registerType').value = '';
            document.getElementById('registerName').value = '';
            document.getElementById('registerUsername').value = '';
            document.getElementById('registerPassword').value = '';
            document.getElementById('registerConfirmPassword').value = '';
            document.getElementById('registerStand').value = '';
            document.getElementById('standSelection').classList.add('hidden');
        }

        // Login functions
        function showLogin(type) {
            userType = type;
            document.getElementById('loginSelection').classList.add('hidden');
            
            if (type === 'student') {
                document.getElementById('loginForm').classList.remove('hidden');
                document.getElementById('loginIcon').textContent = '👨‍🎓';
                document.getElementById('loginTitle').textContent = 'Login Siswa';
            } else {
                document.getElementById('sellerStandSelection').classList.remove('hidden');
            }
        }

        function selectStand(standId) {
            currentSellerStand = standId;
            document.getElementById('sellerStandSelection').classList.add('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('loginIcon').textContent = '👨‍🍳';
            
            const standNames = {
                'miracle': 'Miracle',
                'sepiring-hati': 'Sepiring Hati', 
                'om-china': 'Om China'
            };
            
            document.getElementById('loginTitle').textContent = `Login Penjual ${standNames[standId]}`;
        }

        function backToSelection() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('sellerStandSelection').classList.add('hidden');
            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('loginSelection').classList.remove('hidden');
            userType = null;
            currentSellerStand = null;
        }
        
        function backToStandSelection() {
            if (userType === 'seller') {
                document.getElementById('loginForm').classList.add('hidden');
                document.getElementById('sellerStandSelection').classList.remove('hidden');
            } else {
                backToSelection();
            }
        }

        function handleLogin(event) {
            event.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Clear any existing error messages
            clearLoginError();
            
            // Get user from database
            const user = Database.getUserByUsername(username);
            
            if (!user) {
                showLoginError('❌ Akun tidak ditemukan! Pastikan username sudah benar atau daftar akun baru.');
                return;
            }
            
            if (user.password !== password) {
                showLoginError('🔒 Password salah! Periksa kembali password Anda.');
                return;
            }
            
            // Check user type matches
            if (user.type !== userType) {
                showLoginError(`⚠️ Akun ini terdaftar sebagai ${user.type === 'student' ? 'siswa' : 'penjual'}! Pilih jenis login yang sesuai.`);
                return;
            }
            
            // For seller, check stand matches
            if (userType === 'seller' && user.stand !== currentSellerStand) {
                const standNames = {
                    'miracle': 'Miracle',
                    'sepiring-hati': 'Sepiring Hati',
                    'om-china': 'Om China'
                };
                showLoginError(`🏪 Akun ini terdaftar untuk stand ${standNames[user.stand]}! Pilih stand yang sesuai.`);
                return;
            }
            
            // Login successful
            currentUser = user;
            document.getElementById('loginForm').classList.add('hidden');
            
            if (userType === 'student') {
                document.getElementById('welcomeStudent').textContent = `Selamat datang, ${user.name}!`;
                document.getElementById('studentDashboard').classList.remove('hidden');
                loadMenuItems();
                showOrderDeadlineWarning();
                updateCartCount();
            } else {
                currentSellerStand = user.stand;
                updateSellerDashboardHeader();
                document.getElementById('sellerDashboard').classList.remove('hidden');
                loadSellerProducts();
                loadTodayOrders();
            }
        }

        function showLoginError(message) {
            // Remove existing error if any
            clearLoginError();
            
            // Create error notification
            const errorDiv = document.createElement('div');
            errorDiv.id = 'loginError';
            errorDiv.className = 'bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4 text-sm';
            errorDiv.innerHTML = `
                <div class="flex items-start space-x-2">
                    <span class="flex-shrink-0 mt-0.5">⚠️</span>
                    <div class="flex-1">${message}</div>
                </div>
            `;
            
            // Insert error before the form
            const form = document.querySelector('#loginForm form');
            form.parentNode.insertBefore(errorDiv, form);
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                clearLoginError();
            }, 5000);
        }

        function clearLoginError() {
            const existingError = document.getElementById('loginError');
            if (existingError) {
                existingError.remove();
            }
        }
        
        function updateSellerDashboardHeader() {
            const standInfo = {
                'miracle': { icon: '✨', name: 'Miracle - Western & Fusion' },
                'sepiring-hati': { icon: '❤️', name: 'Sepiring Hati - Masakan Rumahan' },
                'om-china': { icon: '🥢', name: 'Om China - Chinese Food' }
            };
            
            const info = standInfo[currentSellerStand];
            if (info) {
                document.getElementById('sellerStandIcon').textContent = info.icon;
                document.getElementById('sellerStandName').textContent = `${info.name} - ${currentUser.name}`;
            }
        }

        function logout() {
            currentUser = null;
            userType = null;
            currentSellerStand = null;
            cart = [];
            document.getElementById('studentDashboard').classList.add('hidden');
            document.getElementById('sellerDashboard').classList.add('hidden');
            document.getElementById('loginSelection').classList.remove('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        // Account Settings Functions
        function showAccountSettings() {
            const accountInfo = document.getElementById('accountInfo');
            accountInfo.innerHTML = `
                <div class="bg-gray-50 rounded-lg p-4">
                    <h4 class="font-medium text-gray-800 mb-3">Informasi Akun</h4>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Nama:</span>
                            <span class="font-medium">${currentUser.name}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Username:</span>
                            <span class="font-medium">${currentUser.username}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Tipe Akun:</span>
                            <span class="font-medium">${currentUser.type === 'student' ? 'Siswa' : 'Penjual'}</span>
                        </div>
                        ${currentUser.stand ? `
                            <div class="flex justify-between">
                                <span class="text-gray-600">Stand:</span>
                                <span class="font-medium">${getStandName(currentUser.stand)}</span>
                            </div>
                        ` : ''}
                        <div class="flex justify-between">
                            <span class="text-gray-600">Bergabung:</span>
                            <span class="font-medium">${new Date(currentUser.createdAt).toLocaleDateString('id-ID')}</span>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('accountSettingsModal').classList.remove('hidden');
        }

        function closeAccountSettings() {
            document.getElementById('accountSettingsModal').classList.add('hidden');
        }

        function getStandName(standId) {
            const standNames = {
                'miracle': 'Miracle',
                'sepiring-hati': 'Sepiring Hati',
                'om-china': 'Om China'
            };
            return standNames[standId] || standId;
        }

        function showChangePassword() {
            document.getElementById('accountSettingsModal').classList.add('hidden');
            document.getElementById('changePasswordModal').classList.remove('hidden');
        }

        function closeChangePassword() {
            document.getElementById('changePasswordModal').classList.add('hidden');
            document.getElementById('oldPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmNewPassword').value = '';
        }

        function handleChangePassword(event) {
            event.preventDefault();
            
            const oldPassword = document.getElementById('oldPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmNewPassword = document.getElementById('confirmNewPassword').value;
            
            if (oldPassword !== currentUser.password) {
                alert('Password lama salah!');
                return;
            }
            
            if (newPassword !== confirmNewPassword) {
                alert('Password baru dan konfirmasi tidak cocok!');
                return;
            }
            
            if (newPassword.length < 6) {
                alert('Password baru minimal 6 karakter!');
                return;
            }
            
            // Update password in database
            Database.updateUser(currentUser.username, { password: newPassword });
            currentUser.password = newPassword;
            
            alert('Password berhasil diubah!');
            closeChangePassword();
        }

        function confirmDeleteAccount() {
            const confirmation = confirm(
                `PERINGATAN: Tindakan ini akan menghapus akun Anda secara permanen!\n\n` +
                `Semua data termasuk:\n` +
                `- Riwayat pesanan\n` +
                `- Data produk (untuk penjual)\n` +
                `- Informasi akun\n\n` +
                `Apakah Anda yakin ingin menghapus akun "${currentUser.username}"?`
            );
            
            if (confirmation) {
                const finalConfirmation = confirm(
                    `Ketik "HAPUS" untuk mengkonfirmasi penghapusan akun.\n\n` +
                    `Ini adalah kesempatan terakhir untuk membatalkan!`
                );
                
                if (finalConfirmation) {
                    deleteAccount();
                }
            }
        }

        function deleteAccount() {
            try {
                // Delete user from database
                Database.deleteUser(currentUser.username);
                
                // If seller, also delete their products
                if (currentUser.type === 'seller') {
                    const products = Database.getProducts();
                    const filteredProducts = products.filter(product => product.stand !== currentUser.stand);
                    Database.saveProducts(filteredProducts);
                }
                
                alert('Akun berhasil dihapus. Terima kasih telah menggunakan Kenyang!');
                
                // Logout and return to main screen
                logout();
                
            } catch (error) {
                alert('Terjadi kesalahan saat menghapus akun. Silakan coba lagi.');
                console.error('Error deleting account:', error);
            }
        }

        // Menu functions
        function loadMenuItems(standFilter = null) {
            const container = document.getElementById('menuItems');
            container.innerHTML = '';
            
            let products = Database.getProducts();
            if (standFilter) {
                products = products.filter(product => product.stand === standFilter);
            }
            
            products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition duration-300';
                productCard.innerHTML = `
                    <div class="relative">
                        <img src="${product.image}" alt="${product.name}" class="w-full h-48 object-cover" onerror="this.src=''; this.alt='Gambar tidak tersedia'; this.style.display='none';">
                        <div class="absolute top-2 right-2">
                            <span class="text-xs px-2 py-1 rounded-full bg-white bg-opacity-90 text-gray-600">${product.seller}</span>
                        </div>
                    </div>
                    <div class="p-6">
                        <div class="mb-4">
                            <h3 class="text-xl font-bold text-green-primary mb-2">${product.name}</h3>
                            <p class="text-gray-600 text-sm mb-2">${product.description}</p>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-2xl font-bold text-green-primary">Rp ${product.price.toLocaleString()}</span>
                            <button onclick="orderItem(${product.id})" class="order-btn bg-green-primary hover:bg-green-dark text-white px-4 py-2 rounded-lg transition duration-300">
                                Pesan
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(productCard);
            });
        }

        function showStandMenu(standId) {
            const standNames = {
                'miracle': 'Miracle - Western & Fusion',
                'sepiring-hati': 'Sepiring Hati - Masakan Rumahan',
                'om-china': 'Om China - Chinese Food'
            };
            
            document.getElementById('menuTitle').textContent = standNames[standId];
            document.getElementById('backToAllMenus').classList.remove('hidden');
            loadMenuItems(standId);
        }

        function showAllMenus() {
            document.getElementById('menuTitle').textContent = 'Semua Menu';
            document.getElementById('backToAllMenus').classList.add('hidden');
            loadMenuItems();
        }

        function orderItem(productId) {
            const products = Database.getProducts();
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            document.getElementById('orderModalTitle').textContent = `Pesan ${product.name}`;
            
            const content = document.getElementById('orderModalContent');
            content.innerHTML = `
                <div class="mb-4">
                    <img src="${product.image}" alt="${product.name}" class="w-full h-32 object-cover rounded-lg mb-3" onerror="this.style.display='none';">
                    <h4 class="font-bold text-lg mb-2">${product.name}</h4>
                    <p class="text-gray-600 mb-2">${product.description}</p>
                    <p class="text-xl font-bold text-green-primary mb-4">Rp ${product.price.toLocaleString()}</p>
                </div>
                
                <div class="mb-4">
                    <label class="block text-gray-700 font-medium mb-2">Jumlah</label>
                    <input type="number" id="orderQuantity" value="1" min="1" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-primary focus:border-transparent">
                </div>
                
                <div class="mb-6">
                    <h5 class="font-medium text-gray-700 mb-3">Add-ons:</h5>
                    <div class="space-y-2" id="addonsList">
                        ${product.addons.map((addon, index) => `
                            <label class="flex items-center justify-between p-3 border border-gray-300 rounded-lg hover:bg-gray-50 cursor-pointer">
                                <div class="flex items-center space-x-3">
                                    <input type="checkbox" class="addon-checkbox text-green-primary" data-name="${addon.name}" data-price="${addon.price}">
                                    <span>${addon.name}</span>
                                </div>
                                <span class="text-green-primary font-medium">+Rp ${addon.price.toLocaleString()}</span>
                            </label>
                        `).join('')}
                    </div>
                </div>
                
                <button onclick="addToCart(${productId})" class="w-full bg-green-primary hover:bg-green-dark text-white font-semibold py-3 px-6 rounded-lg transition duration-300">
                    Tambah ke Keranjang
                </button>
            `;
            
            document.getElementById('orderModal').classList.remove('hidden');
        }

        function closeOrderModal() {
            document.getElementById('orderModal').classList.add('hidden');
        }

        function addToCart(productId) {
            const products = Database.getProducts();
            const product = products.find(p => p.id === productId);
            const quantity = parseInt(document.getElementById('orderQuantity').value);
            const selectedAddons = [];
            
            document.querySelectorAll('.addon-checkbox:checked').forEach(checkbox => {
                selectedAddons.push({
                    name: checkbox.dataset.name,
                    price: parseInt(checkbox.dataset.price)
                });
            });
            
            const cartItem = {
                id: Date.now(),
                productId: productId,
                name: product.name,
                price: product.price,
                quantity: quantity,
                addons: selectedAddons,
                total: (product.price + selectedAddons.reduce((sum, addon) => sum + addon.price, 0)) * quantity
            };
            
            cart.push(cartItem);
            updateCartCount();
            closeOrderModal();
            
            // Show success message
            alert(`${product.name} berhasil ditambahkan ke keranjang!`);
        }

        function updateCartCount() {
            document.getElementById('cartCount').textContent = cart.length;
        }

        // Cart functions
        function showCart() {
            const cartItems = document.getElementById('cartItems');
            cartItems.innerHTML = '';
            
            if (cart.length === 0) {
                cartItems.innerHTML = '<p class="text-gray-500 text-center py-4">Keranjang kosong</p>';
            } else {
                cart.forEach((item, index) => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'border border-gray-200 rounded-lg p-4';
                    itemDiv.innerHTML = `
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="font-medium">${item.name}</h4>
                            <button onclick="removeFromCart(${index})" class="text-red-500 hover:text-red-700">×</button>
                        </div>
                        <p class="text-sm text-gray-600 mb-2">Jumlah: ${item.quantity}</p>
                        ${item.addons.length > 0 ? `
                            <div class="text-sm text-gray-600 mb-2">
                                Add-ons: ${item.addons.map(addon => addon.name).join(', ')}
                            </div>
                        ` : ''}
                        <p class="font-bold text-green-primary">Rp ${item.total.toLocaleString()}</p>
                    `;
                    cartItems.appendChild(itemDiv);
                });
            }
            
            updateCartTotal();
            document.getElementById('cartModal').classList.remove('hidden');
        }

        function closeCart() {
            document.getElementById('cartModal').classList.add('hidden');
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            updateCartCount();
            showCart();
        }

        function updateCartTotal() {
            const total = cart.reduce((sum, item) => sum + item.total, 0);
            document.getElementById('cartTotal').textContent = `Rp ${total.toLocaleString()}`;
        }

        function checkout() {
            const selectedPayment = document.querySelector('input[name="payment"]:checked');
            
            if (cart.length === 0) {
                alert('Keranjang kosong!');
                return;
            }
            
            if (!selectedPayment) {
                alert('Pilih metode pembayaran!');
                return;
            }
            
            const order = {
                student: currentUser.username,
                items: [...cart],
                total: cart.reduce((sum, item) => sum + item.total, 0),
                payment: selectedPayment.value,
                status: 'pending',
                paymentStatus: 'unpaid',
                timestamp: new Date().toISOString()
            };
            
            Database.addOrder(order);
            
            // Show payment info popup
            showPaymentInfo(order);
            
            cart = [];
            updateCartCount();
            closeCart();
        }

        function showPaymentInfo(order) {
            const products = Database.getProducts();
            // Get sellers from order items
            const sellersInOrder = [...new Set(order.items.map(item => {
                const product = products.find(p => p.id === item.productId);
                return product ? product.seller : null;
            }).filter(seller => seller))];
            
            // Group items by seller
            const itemsBySeller = {};
            order.items.forEach(item => {
                const product = products.find(p => p.id === item.productId);
                if (product) {
                    if (!itemsBySeller[product.seller]) {
                        itemsBySeller[product.seller] = [];
                    }
                    itemsBySeller[product.seller].push(item);
                }
            });
            
            const content = document.getElementById('paymentInfoContent');
            content.innerHTML = '';
            
            // Show order summary
            const orderSummary = document.createElement('div');
            orderSummary.className = 'bg-gray-50 rounded-lg p-4 mb-4';
            orderSummary.innerHTML = `
                <h4 class="font-medium text-gray-800 mb-3">Ringkasan Pesanan:</h4>
                <div class="space-y-2 text-sm">
                    ${order.items.map(item => `
                        <div class="flex justify-between">
                            <span>${item.quantity}x ${item.name}</span>
                            <span>Rp ${item.total.toLocaleString()}</span>
                        </div>
                    `).join('')}
                </div>
                <div class="border-t mt-3 pt-3 flex justify-between font-bold">
                    <span>Total Pembayaran:</span>
                    <span class="text-green-primary">Rp ${order.total.toLocaleString()}</span>
                </div>
                <div class="mt-2 text-sm text-gray-600">
                    Metode: ${order.payment.toUpperCase()}
                </div>
            `;
            content.appendChild(orderSummary);
            
            // Show payment method specific info
            const bankAccounts = Database.getBankAccounts();
            
            if (order.payment === 'gopay') {
                // Show GoPay payment info
                const gopayCard = document.createElement('div');
                gopayCard.className = 'border border-green-200 rounded-lg p-4 bg-green-50';
                gopayCard.innerHTML = `
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="font-bold text-green-800">💚 GoPay</h4>
                        <span class="text-sm bg-green-200 text-green-800 px-2 py-1 rounded">
                            Rp ${order.total.toLocaleString()}
                        </span>
                    </div>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Nomor GoPay:</span>
                            <span class="font-mono font-bold text-lg">088263481927</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Atas Nama:</span>
                            <span class="font-medium">Kantin Sekolah</span>
                        </div>
                    </div>
                    <div class="mt-3 text-xs text-green-700">
                        Transfer ke nomor GoPay di atas dengan total yang tertera
                    </div>
                `;
                content.appendChild(gopayCard);
            } else {
                // Show bank account info for each seller (BCA payment)
                sellersInOrder.forEach(seller => {
                    const bankInfo = bankAccounts[seller];
                    if (bankInfo) {
                        const sellerItems = itemsBySeller[seller];
                        const sellerTotal = sellerItems.reduce((sum, item) => sum + item.total, 0);
                        
                        const bankCard = document.createElement('div');
                        bankCard.className = 'border border-green-200 rounded-lg p-4 bg-green-50';
                        bankCard.innerHTML = `
                            <div class="flex items-center justify-between mb-3">
                                <h4 class="font-bold text-green-800">${seller}</h4>
                                <span class="text-sm bg-green-200 text-green-800 px-2 py-1 rounded">
                                    Rp ${sellerTotal.toLocaleString()}
                                </span>
                            </div>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Bank:</span>
                                    <span class="font-medium">${bankInfo.bank}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">No. Rekening:</span>
                                    <span class="font-mono font-bold text-lg">${bankInfo.accountNumber}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Atas Nama:</span>
                                    <span class="font-medium">${bankInfo.accountName}</span>
                                </div>
                            </div>
                            <div class="mt-3 text-xs text-green-700">
                                Items: ${sellerItems.map(item => `${item.quantity}x ${item.name}`).join(', ')}
                            </div>
                        `;
                        content.appendChild(bankCard);
                    }
                });
            }
            
            document.getElementById('paymentInfoModal').classList.remove('hidden');
        }

        function closePaymentInfo() {
            document.getElementById('paymentInfoModal').classList.add('hidden');
        }

        // Payment History Functions
        function showPaymentHistory() {
            document.getElementById('paymentHistoryModal').classList.remove('hidden');
            filterHistory('all');
        }

        function closePaymentHistory() {
            document.getElementById('paymentHistoryModal').classList.add('hidden');
        }

        function filterHistory(filter) {
            // Update active tab
            document.querySelectorAll('#paymentHistoryModal button[id^="filter"]').forEach(btn => {
                btn.className = 'px-4 py-2 rounded-lg bg-gray-200 text-gray-700 font-medium hover:bg-gray-300';
            });
            document.getElementById(`filter${filter.charAt(0).toUpperCase() + filter.slice(1)}`).className = 'px-4 py-2 rounded-lg bg-green-primary text-white font-medium';

            // Filter orders for current user
            const orders = Database.getOrders();
            const userOrders = orders.filter(order => order.student === currentUser.username);
            let filteredOrders = userOrders;

            if (filter === 'paid') {
                filteredOrders = userOrders.filter(order => order.paymentStatus === 'paid');
            } else if (filter === 'unpaid') {
                filteredOrders = userOrders.filter(order => order.paymentStatus === 'unpaid');
            }

            displayHistoryItems(filteredOrders);
        }

        function displayHistoryItems(ordersList) {
            const container = document.getElementById('historyContent');
            container.innerHTML = '';

            if (ordersList.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <div class="text-4xl mb-4">📋</div>
                        <p>Belum ada riwayat pembayaran</p>
                    </div>
                `;
                return;
            }

            ordersList.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

            const products = Database.getProducts();
            const bankAccounts = Database.getBankAccounts();

            ordersList.forEach(order => {
                const orderDate = new Date(order.timestamp);
                const isPaid = order.paymentStatus === 'paid';
                
                // Group items by seller
                const itemsBySeller = {};
                order.items.forEach(item => {
                    const product = products.find(p => p.id === item.productId);
                    if (product) {
                        if (!itemsBySeller[product.seller]) {
                            itemsBySeller[product.seller] = [];
                        }
                        itemsBySeller[product.seller].push(item);
                    }
                });

                const orderCard = document.createElement('div');
                orderCard.className = `bg-white rounded-xl shadow-lg border-l-4 ${isPaid ? 'border-green-500' : 'border-red-500'} p-6`;
                
                orderCard.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <div class="flex items-center space-x-3 mb-2">
                                <h4 class="text-lg font-bold text-gray-800">Pesanan #${order.id.toString().slice(-6)}</h4>
                                <span class="px-3 py-1 rounded-full text-sm font-medium ${isPaid ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                    ${isPaid ? '✅ Sudah Bayar' : '❌ Belum Bayar'}
                                </span>
                            </div>
                            <p class="text-sm text-gray-600">${orderDate.toLocaleDateString('id-ID', { 
                                weekday: 'long', 
                                year: 'numeric', 
                                month: 'long', 
                                day: 'numeric',
                                hour: '2-digit',
                                minute: '2-digit'
                            })}</p>
                        </div>
                        <div class="text-right">
                            <p class="text-2xl font-bold text-green-primary">Rp ${order.total.toLocaleString()}</p>
                            <p class="text-sm text-gray-600">${order.payment.toUpperCase()}</p>
                        </div>
                    </div>

                    <!-- Order Items -->
                    <div class="bg-gray-50 rounded-lg p-4 mb-4">
                        <h5 class="font-medium text-gray-800 mb-3">Detail Pesanan:</h5>
                        <div class="space-y-2">
                            ${order.items.map(item => `
                                <div class="flex justify-between items-center text-sm">
                                    <span>${item.quantity}x ${item.name}</span>
                                    <span class="font-medium">Rp ${item.total.toLocaleString()}</span>
                                </div>
                                ${item.addons.length > 0 ? `
                                    <div class="text-xs text-gray-600 ml-4">
                                        Add-ons: ${item.addons.map(addon => addon.name).join(', ')}
                                    </div>
                                ` : ''}
                            `).join('')}
                        </div>
                    </div>

                    <!-- Payment Info by Method -->
                    <div class="space-y-3 mb-4">
                        <h5 class="font-medium text-gray-800">Informasi Transfer:</h5>
                        ${order.payment === 'gopay' ? `
                            <div class="bg-green-50 border border-green-200 rounded-lg p-3">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="font-medium text-green-800">💚 GoPay</span>
                                    <span class="text-sm bg-green-200 text-green-800 px-2 py-1 rounded">
                                        Rp ${order.total.toLocaleString()}
                                    </span>
                                </div>
                                <div class="text-sm space-y-1">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Nomor GoPay:</span>
                                        <span class="font-mono font-bold">088263481927</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Atas Nama:</span>
                                        <span class="font-medium">Kantin Sekolah</span>
                                    </div>
                                </div>
                            </div>
                        ` : Object.keys(itemsBySeller).map(seller => {
                            const sellerItems = itemsBySeller[seller];
                            const sellerTotal = sellerItems.reduce((sum, item) => sum + item.total, 0);
                            const bankInfo = bankAccounts[seller];
                            
                            return `
                                <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="font-medium text-blue-800">${seller}</span>
                                        <span class="text-sm bg-blue-200 text-blue-800 px-2 py-1 rounded">
                                            Rp ${sellerTotal.toLocaleString()}
                                        </span>
                                    </div>
                                    ${bankInfo ? `
                                        <div class="text-sm space-y-1">
                                            <div class="flex justify-between">
                                                <span class="text-gray-600">Bank:</span>
                                                <span class="font-medium">${bankInfo.bank}</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-gray-600">No. Rekening:</span>
                                                <span class="font-mono font-bold">${bankInfo.accountNumber}</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-gray-600">Atas Nama:</span>
                                                <span class="font-medium">${bankInfo.accountName}</span>
                                            </div>
                                        </div>
                                    ` : '<p class="text-sm text-gray-600">Info rekening tidak tersedia</p>'}
                                </div>
                            `;
                        }).join('')}
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex space-x-3">
                        ${!isPaid ? `
                            <button onclick="markAsPaid(${order.id})" class="flex-1 bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition duration-300 font-medium">
                                ✅ Tandai Sudah Bayar
                            </button>
                            <button onclick="showPaymentDetails(${order.id})" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition duration-300 font-medium">
                                📋 Lihat Detail Transfer
                            </button>
                        ` : `
                            <button onclick="markAsUnpaid(${order.id})" class="flex-1 bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition duration-300 font-medium">
                                ❌ Tandai Belum Bayar
                            </button>
                            <button onclick="showPaymentDetails(${order.id})" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition duration-300 font-medium">
                                📋 Lihat Detail Transfer
                            </button>
                        `}
                    </div>
                `;
                
                container.appendChild(orderCard);
            });
        }

        function markAsPaid(orderId) {
            Database.updateOrder(orderId, { paymentStatus: 'paid' });
            // Get current active filter
            const activeFilter = document.querySelector('#paymentHistoryModal button.bg-green-primary').id.replace('filter', '').toLowerCase();
            filterHistory(activeFilter); // Refresh display with current filter
            alert('Pesanan berhasil ditandai sebagai sudah bayar!');
        }

        function markAsUnpaid(orderId) {
            if (confirm('Yakin ingin menandai pesanan ini sebagai belum bayar?')) {
                Database.updateOrder(orderId, { paymentStatus: 'unpaid' });
                // Get current active filter
                const activeFilter = document.querySelector('#paymentHistoryModal button.bg-green-primary').id.replace('filter', '').toLowerCase();
                filterHistory(activeFilter); // Refresh display with current filter
                alert('Pesanan berhasil ditandai sebagai belum bayar!');
            }
        }

        function showPaymentDetails(orderId) {
            const orders = Database.getOrders();
            const order = orders.find(o => o.id === orderId);
            if (order) {
                showPaymentInfo(order);
            }
        }

        // Seller functions
        function loadSellerProducts() {
            const container = document.getElementById('sellerProducts');
            container.innerHTML = '';
            
            // Filter products by current seller stand
            const products = Database.getProducts();
            const sellerProducts = products.filter(p => p.stand === currentSellerStand);
            
            if (sellerProducts.length === 0) {
                container.innerHTML = '<div class="col-span-2 text-center py-8 text-gray-500"><p>Belum ada produk. Klik "Tambah Produk" untuk menambah menu baru.</p></div>';
                return;
            }
            
            sellerProducts.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'bg-white rounded-xl shadow-lg overflow-hidden';
                productCard.innerHTML = `
                    <div class="relative">
                        <img src="${product.image}" alt="${product.name}" class="w-full h-32 object-cover" onerror="this.style.display='none';">
                    </div>
                    <div class="p-4">
                        <h3 class="text-lg font-bold text-green-primary mb-2">${product.name}</h3>
                        <p class="text-gray-600 text-sm mb-2">${product.description}</p>
                        <p class="text-xl font-bold text-green-primary mb-3">Rp ${product.price.toLocaleString()}</p>
                        <div class="mb-3">
                            <p class="text-sm font-medium text-gray-700 mb-1">Add-ons:</p>
                            <div class="text-sm text-gray-600">
                                ${product.addons.length > 0 ? product.addons.map(addon => `${addon.name} (+Rp ${addon.price.toLocaleString()})`).join(', ') : 'Tidak ada add-ons'}
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="editProduct(${product.id})" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition duration-300">
                                Edit
                            </button>
                            <button onclick="deleteProduct(${product.id})" class="flex-1 bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition duration-300">
                                Hapus
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(productCard);
            });
        }

        function loadTodayOrders() {
            const container = document.getElementById('todayOrders');
            container.innerHTML = '';
            
            const orders = Database.getOrders();
            const products = Database.getProducts();
            
            // Filter orders that contain products from current seller's stand
            const sellerOrders = orders.filter(order => {
                return order.items.some(item => {
                    const product = products.find(p => p.id === item.productId);
                    return product && product.stand === currentSellerStand;
                });
            });
            
            if (sellerOrders.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">Belum ada pesanan hari ini</p>';
                return;
            }
            
            sellerOrders.forEach(order => {
                // Filter items for this seller only
                const sellerItems = order.items.filter(item => {
                    const product = products.find(p => p.id === item.productId);
                    return product && product.stand === currentSellerStand;
                });
                
                if (sellerItems.length === 0) return;
                
                const sellerTotal = sellerItems.reduce((sum, item) => sum + item.total, 0);
                
                const orderCard = document.createElement('div');
                orderCard.className = 'bg-white rounded-lg shadow p-4 border-l-4 border-green-primary';
                orderCard.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-bold">${order.student}</h4>
                        <span class="text-sm px-2 py-1 rounded ${order.status === 'pending' ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800'}">
                            ${order.status === 'pending' ? 'Menunggu' : 'Selesai'}
                        </span>
                    </div>
                    <div class="text-sm text-gray-600 mb-2">
                        ${sellerItems.map(item => `${item.quantity}x ${item.name}`).join(', ')}
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="font-bold text-green-primary">Rp ${sellerTotal.toLocaleString()}</span>
                        <span class="text-xs text-gray-500">${order.payment.toUpperCase()}</span>
                    </div>
                    ${order.status === 'pending' ? `
                        <button onclick="completeOrder(${order.id})" class="w-full mt-3 bg-green-primary hover:bg-green-dark text-white px-4 py-2 rounded-lg transition duration-300">
                            Tandai Selesai
                        </button>
                    ` : ''}
                `;
                container.appendChild(orderCard);
            });
        }

        function completeOrder(orderId) {
            Database.updateOrder(orderId, { status: 'completed' });
            loadTodayOrders();
        }

        function showAddProduct() {
            document.getElementById('addProductModal').classList.remove('hidden');
        }

        function closeAddProduct() {
            document.getElementById('addProductModal').classList.add('hidden');
            document.getElementById('productName').value = '';
            document.getElementById('productPrice').value = '';
            document.getElementById('productDescription').value = '';
            document.getElementById('productImageUrl').value = '';
            document.getElementById('bankName').value = '';
            document.getElementById('accountNumber').value = '';
            document.getElementById('accountName').value = '';
            
            // Reset image upload
            document.getElementById('productImageFile').value = '';
            delete document.getElementById('productImageFile').dataset.base64;
            document.getElementById('imagePreview').classList.add('hidden');
            
            // Reset addons
            const container = document.getElementById('addonsContainer');
            container.innerHTML = `
                <div class="flex space-x-2">
                    <input type="text" placeholder="Nama add-on" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg">
                    <input type="number" placeholder="Harga" class="w-24 px-3 py-2 border border-gray-300 rounded-lg">
                    <button type="button" onclick="removeAddon(this)" class="bg-red-500 text-white px-3 py-2 rounded-lg hover:bg-red-600">-</button>
                </div>
            `;
        }

        function addAddonField() {
            const container = document.getElementById('addonsContainer');
            const addonDiv = document.createElement('div');
            addonDiv.className = 'flex space-x-2';
            addonDiv.innerHTML = `
                <input type="text" placeholder="Nama add-on" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg">
                <input type="number" placeholder="Harga" class="w-24 px-3 py-2 border border-gray-300 rounded-lg">
                <button type="button" onclick="removeAddon(this)" class="bg-red-500 text-white px-3 py-2 rounded-lg hover:bg-red-600">-</button>
            `;
            container.appendChild(addonDiv);
        }

        function removeAddon(button) {
            button.parentElement.remove();
        }

        function addProduct(event) {
            event.preventDefault();
            
            const name = document.getElementById('productName').value;
            const price = parseInt(document.getElementById('productPrice').value);
            const description = document.getElementById('productDescription').value;
            
            // Get image from file upload or URL
            let image = '';
            const fileInput = document.getElementById('productImageFile');
            const urlInput = document.getElementById('productImageUrl');
            
            if (fileInput.dataset.base64) {
                // Use uploaded image (base64)
                image = fileInput.dataset.base64;
            } else if (urlInput.value) {
                // Use URL
                image = urlInput.value;
            } else {
                // Use default placeholder
                image = 'https://via.placeholder.com/300x200/4ade80/ffffff?text=Menu+Baru';
            }
            
            // Update bank account info
            const bankName = document.getElementById('bankName').value;
            const accountNumber = document.getElementById('accountNumber').value;
            const accountName = document.getElementById('accountName').value;
            
            const standNames = {
                'miracle': 'Miracle',
                'sepiring-hati': 'Sepiring Hati',
                'om-china': 'Om China'
            };
            
            const sellerName = standNames[currentSellerStand];
            
            if (bankName && accountNumber && accountName) {
                Database.updateBankAccount(sellerName, {
                    bank: bankName,
                    accountNumber: accountNumber,
                    accountName: accountName
                });
            }
            
            // Collect addons
            const addons = [];
            const addonRows = document.querySelectorAll('#addonsContainer > div');
            addonRows.forEach(row => {
                const nameInput = row.querySelector('input[type="text"]');
                const priceInput = row.querySelector('input[type="number"]');
                
                if (nameInput.value && priceInput.value) {
                    addons.push({
                        name: nameInput.value,
                        price: parseInt(priceInput.value)
                    });
                }
            });
            
            const newProduct = {
                name: name,
                price: price,
                description: description,
                image: image,
                seller: sellerName,
                stand: currentSellerStand,
                addons: addons
            };
            
            Database.addProduct(newProduct);
            closeAddProduct();
            loadSellerProducts();
            
            alert('Produk berhasil ditambahkan!');
        }

        function editProduct(productId) {
            const products = Database.getProducts();
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            // Populate form with current product data
            document.getElementById('editProductId').value = product.id;
            document.getElementById('editProductName').value = product.name;
            document.getElementById('editProductPrice').value = product.price;
            document.getElementById('editProductDescription').value = product.description;
            
            // Handle image display
            if (product.image && product.image !== 'https://via.placeholder.com/300x200/4ade80/ffffff?text=Menu+Baru') {
                // Show current image
                document.getElementById('currentImg').src = product.image;
                document.getElementById('currentImageDisplay').classList.remove('hidden');
                
                // If it's a URL (not base64), put it in URL field
                if (!product.image.startsWith('data:')) {
                    document.getElementById('editProductImageUrl').value = product.image;
                }
            } else {
                document.getElementById('currentImageDisplay').classList.add('hidden');
                document.getElementById('editProductImageUrl').value = '';
            }
            
            // Reset new image preview
            document.getElementById('editImagePreview').classList.add('hidden');
            document.getElementById('editProductImageFile').value = '';
            delete document.getElementById('editProductImageFile').dataset.base64;
            
            // Populate add-ons
            const container = document.getElementById('editAddonsContainer');
            container.innerHTML = '';
            
            product.addons.forEach(addon => {
                const addonDiv = document.createElement('div');
                addonDiv.className = 'flex space-x-2';
                addonDiv.innerHTML = `
                    <input type="text" value="${addon.name}" placeholder="Nama add-on" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg">
                    <input type="number" value="${addon.price}" placeholder="Harga" class="w-24 px-3 py-2 border border-gray-300 rounded-lg">
                    <button type="button" onclick="removeEditAddon(this)" class="bg-red-500 text-white px-3 py-2 rounded-lg hover:bg-red-600">-</button>
                `;
                container.appendChild(addonDiv);
            });
            
            // Add empty field if no add-ons
            if (product.addons.length === 0) {
                addEditAddonField();
            }
            
            document.getElementById('editProductModal').classList.remove('hidden');
        }
        
        function closeEditProduct() {
            document.getElementById('editProductModal').classList.add('hidden');
            
            // Reset image displays
            document.getElementById('currentImageDisplay').classList.add('hidden');
            document.getElementById('editImagePreview').classList.add('hidden');
            document.getElementById('editProductImageFile').value = '';
            document.getElementById('editProductImageUrl').value = '';
            delete document.getElementById('editProductImageFile').dataset.base64;
        }
        
        function addEditAddonField() {
            const container = document.getElementById('editAddonsContainer');
            const addonDiv = document.createElement('div');
            addonDiv.className = 'flex space-x-2';
            addonDiv.innerHTML = `
                <input type="text" placeholder="Nama add-on" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg">
                <input type="number" placeholder="Harga" class="w-24 px-3 py-2 border border-gray-300 rounded-lg">
                <button type="button" onclick="removeEditAddon(this)" class="bg-red-500 text-white px-3 py-2 rounded-lg hover:bg-red-600">-</button>
            `;
            container.appendChild(addonDiv);
        }
        
        function removeEditAddon(button) {
            button.parentElement.remove();
        }
        
        function updateProduct(event) {
            event.preventDefault();
            
            const productId = parseInt(document.getElementById('editProductId').value);
            const name = document.getElementById('editProductName').value;
            const price = parseInt(document.getElementById('editProductPrice').value);
            const description = document.getElementById('editProductDescription').value;
            
            // Get image from file upload, URL, or keep current
            let image = '';
            const fileInput = document.getElementById('editProductImageFile');
            const urlInput = document.getElementById('editProductImageUrl');
            const currentImg = document.getElementById('currentImg');
            
            if (fileInput.dataset.base64) {
                // Use new uploaded image (base64)
                image = fileInput.dataset.base64;
            } else if (urlInput.value) {
                // Use new URL
                image = urlInput.value;
            } else if (currentImg.src && !currentImg.src.includes('placeholder')) {
                // Keep current image
                image = currentImg.src;
            } else {
                // Use default placeholder
                image = 'https://via.placeholder.com/300x200/4ade80/ffffff?text=Menu+Baru';
            }
            
            // Collect addons
            const addons = [];
            const addonRows = document.querySelectorAll('#editAddonsContainer > div');
            addonRows.forEach(row => {
                const nameInput = row.querySelector('input[type="text"]');
                const priceInput = row.querySelector('input[type="number"]');
                
                if (nameInput.value && priceInput.value) {
                    addons.push({
                        name: nameInput.value,
                        price: parseInt(priceInput.value)
                    });
                }
            });
            
            // Update product
            Database.updateProduct(productId, {
                name: name,
                price: price,
                description: description,
                image: image,
                addons: addons
            });
            
            closeEditProduct();
            loadSellerProducts();
            
            alert('Produk berhasil diupdate!');
        }

        function deleteProduct(productId) {
            if (confirm('Yakin ingin menghapus produk ini?')) {
                Database.deleteProduct(productId);
                loadSellerProducts();
                alert('Produk berhasil dihapus!');
            }
        }

        // Image Upload Functions
        function handleImageUpload(input, previewId) {
            const file = input.files[0];
            if (!file) return;
            
            // Validate file type
            if (!file.type.startsWith('image/')) {
                alert('File harus berupa gambar!');
                input.value = '';
                return;
            }
            
            // Validate file size (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('Ukuran gambar maksimal 5MB!');
                input.value = '';
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const previewContainer = document.getElementById(previewId);
                const previewImg = previewContainer.querySelector('img');
                
                previewImg.src = e.target.result;
                previewContainer.classList.remove('hidden');
                
                // Store the base64 data for saving
                input.dataset.base64 = e.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        function removeImage(previewId) {
            const previewContainer = document.getElementById(previewId);
            const previewImg = previewContainer.querySelector('img');
            
            previewImg.src = '';
            previewContainer.classList.add('hidden');
            
            // Clear the file input
            if (previewId === 'imagePreview') {
                document.getElementById('productImageFile').value = '';
                delete document.getElementById('productImageFile').dataset.base64;
            } else if (previewId === 'editImagePreview') {
                document.getElementById('editProductImageFile').value = '';
                delete document.getElementById('editProductImageFile').dataset.base64;
            }
        }
        
        function setupDragAndDrop() {
            // Setup drag and drop for add product modal
            const addDropZone = document.querySelector('#addProductModal .border-dashed');
            if (addDropZone) {
                setupDropZone(addDropZone, 'productImageFile', 'imagePreview');
            }
            
            // Setup drag and drop for edit product modal
            const editDropZone = document.querySelector('#editProductModal .border-dashed');
            if (editDropZone) {
                setupDropZone(editDropZone, 'editProductImageFile', 'editImagePreview');
            }
        }
        
        function setupDropZone(dropZone, inputId, previewId) {
            dropZone.addEventListener('dragover', function(e) {
                e.preventDefault();
                dropZone.classList.add('border-green-primary', 'bg-green-50');
            });
            
            dropZone.addEventListener('dragleave', function(e) {
                e.preventDefault();
                dropZone.classList.remove('border-green-primary', 'bg-green-50');
            });
            
            dropZone.addEventListener('drop', function(e) {
                e.preventDefault();
                dropZone.classList.remove('border-green-primary', 'bg-green-50');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    const input = document.getElementById(inputId);
                    input.files = files;
                    handleImageUpload(input, previewId);
                }
            });
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            // Setup drag and drop functionality
            setupDragAndDrop();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9722ae08542cae45',t:'MTc1NTcwMTE4My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
